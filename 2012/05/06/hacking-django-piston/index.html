<!--
                                                          _ 
|  ||_  _ |_   _  _ _     _      | _  _ | . _  _    _ |_   )
|/\|| )(_||_  (_|| (-  \/(_)|_|  |(_)(_)|(|| )(_)  (_||_  . 
                       /                      _/            
                              
|__| _    _   _   | .|_|_     
|  |(_|\/(-  (_|  |(||_|_\/.  
                         /    
    
                   .               ,.
                  T."-._..---.._,-"/|
                  l|"-.  _.v._   (" |
                  [l /.'_ \; _~"-.`-t
                  Y " _(o} _{o)._ ^.|
                  j  T  ,-<v>-.  T  ]
                  \  l ( /-^-\ ) !  !
                   \. \.  "~"  ./  /c-..,__
                     ^r- .._ .- .-"  `- .  ~"--.
                      > \.                      \
                      ]   ^.                     \
                      3  .  ">            .       Y  
         ,.__.--._   _j   \ ~   .         ;       |
        (    ~"-._~"^._\   ^.    ^._      I     . l
         "-._ ___ ~"-,_7    .Z-._   7"   Y      ;  \       
            /"   "~-(r r  _/_--._~-/    /      /,.--^-._   
            "-._    '"~~~>-._~]>--^---./____,.^~        ^.
                ~--._    '   Y---.                        \
                     ~~--._  l_   )                        \
                           ~-._~~~---._,____..---           \
                               ~----"~       \
                                              \
-->
<!DOCTYPE HTML>
<html>
    <head>
    <title>Hacking Django-Piston | Bhashkar Sharma</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui" />
    <meta name="description" content="At MobStac, we are working on building REST API support for the system. After evaluating various REST API framworks for django, I chose to go with django-piston.">
    <link rel="canonical" href="http://rockerhome.wordpress.com/2012/05/06/hacking-django-piston/"/>
    <meta name="keywords" content="">
    <meta property="profile:first_name" content="Bhashkar" />
<meta property="profile:last_name" content="Sharma" />
<meta property="og:title" content="Hacking Django-Piston | Bhashkar Sharma" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://bhashkar.me/2012/05/06/hacking-django-piston/" />
<meta property="og:image" content="http://bhashkar.me/images/profile_new2.jpg" />
    <link rel="alternate" href="http://bhashkar.me/feed.xml" type="application/rss+xml" title="Bhashkar Sharma">
    <!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
    <script src="/js/jquery.min.js"></script>
    <!-- 
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/jquery.scrollzer.min.js"></script>
    -->
    <script src="/js/skel.min.js"></script>
    <script src="/js/skel-layers.min.js"></script>
    <script src="/js/init.js"></script>
    <noscript>
        <link rel="stylesheet" href="css/skel.css" />
        <link rel="stylesheet" href="css/style.css" />
        <link rel="stylesheet" href="css/style-wide.css" />
    </noscript>
    <!--[if lte IE 9]><link rel="stylesheet" href="/css/ie/v9.css" /><![endif]-->
    <!--[if lte IE 8]><link rel="stylesheet" href="/css/ie/v8.css" /><![endif]-->
    
    
    
</head>
    <body>

        <!-- Header -->
            <div id="header" class="skel-layers-fixed">

                <div class="top">

                    <!-- Logo -->
                        <div id="logo">
                            <span class="image avatar48">
                              <img src="/images/profile_new.jpg" alt="Profile" />
                            </span>
                            <h1 id="title">Bhashkar Sharma</h1>
                            <p></p>
                        </div>

                    <!-- Nav -->
                        <nav id="nav">
                            <ul>
                                <li><a href="/#top" id="top-link" class="skel-layers-ignoreHref"><span class="icon fa-home">Intro</span></a></li>
                                <li><a href="/#about" id="about-link" class="skel-layers-ignoreHref"><span class="icon fa-user">About Me</span></a></li>
                                <li><a href="/#lab" id="lab-link" class="skel-layers-ignoreHref"><span class="icon fa-rocket">Lab</span></a></li>
                                <li><a href="/#posts" id="posts-link" class="skel-layers-ignoreHref"><span class="icon fa-book">Posts</span></a></li>
                            </ul>
                        </nav>
                        
                </div>
                
                <div class="bottom">

                    <!-- Social Icons -->
                        <ul class="icons">
                            <li><a href="https://twitter.com/bhashkarsharma" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
                            <li><a href="https://linkedin.com/in/bhashkarsharma" class="icon fa-linkedin"><span class="label">LinkedIn</span></a></li>
                            <li><a href="http://github.com/bhashkarsharma" class="icon fa-github"><span class="label">Github</span></a></li>
                            <li><a href="mailto:info@bhashkar.me" class="icon fa-envelope"><span class="label">Email</span></a></li>
                        </ul>
                
                </div>
            
            </div>

        <!-- Main -->
            <div id="main">

                

<!-- post -->
<section id="post">
    <article class="container box style3">
        <header>
            <h2><a href="/2012/05/06/hacking-django-piston/">Hacking Django-Piston</a></h2>
            <p class="date"><span>May 06, 2012</span></p>
        </header>
        <section>
            <p>At <a href="http://mobstac.com/">MobStac</a>, we are working on building <span class="caps">REST</span> API support for the system. After evaluating various REST API framworks for <a href="http://djangoproject.com/">django</a>, I chose to go with <a href="https://bitbucket.org/jespern/django-piston/">django-piston</a>.<span class="more" /></p>
<p>Trust me, there is hundreds of pages such as <a href="http://stackoverflow.com/questions/656979/django-and-restful-apis">this one</a> debating on which framework to go with, and amongst the top choices (alongside piston) were <a href="http://django-rest-framework.org/">Django <span class="caps">REST</span> Framework</a>, <a href="http://code.google.com/p/django-rest-interface/wiki/RestifyDjango">RESTify Django</a> and&nbsp;others. </p>
<p>The reason we chose to go with piston is because of the use case we had; which is: an already existing web <span class="caps">UI</span> to perform actions, to which (at least for now) the API is going to be a supporting component. Piston is quite well-written, comes with out-of-the-box support for standard output formats (XML, JSON, YAML) and has Basic HTTP Authentication and OAuth built&nbsp;in.</p>
<p>The down-sides, on the other hand, are that it is not well maintained, and there exist almost 150 forks to it, which people created to solve their own problem set. It would have been much better had there been an active support community and integrating features into&nbsp;piston.</p>
<p>One thing I did not understand is the reason to why the author himself has forked it to create another repo that supports OAuth2. I mean, OAuth2 has essentially become the de-facto standard and OAuth has been phased out, especially by the majors (twitter and&nbsp;facebook).</p>
<p>I personally think it would have made more sense to deprecate OAuth support from the main branch.&nbsp;Anyways.</p>
<p>[<strong>Update: </strong>After reading <a href="http://hueniverse.com/2012/07/oauth-2-0-and-the-road-to-hell/">this article</a> I want to take back what I said above about OAuth&nbsp;2.0.]</p>
<p>As has been my experience with using the plug-and-play frameworks, there are rarely the ones which, essentially, just work to suit your use case. I experienced the same thing when I was building the MobStac Authentication module and tried using <a href="https://bitbucket.org/ubernostrum/django-registration/">django-registration</a>. It worked for a while, but soon we outgrew it’s capabilities (when we had to start adding support for Facebook/Twitter OAuth2 integration, or payment for example). Eventually we had to scrap it and write our own Auth module which, so far, has scaled well. Although there are traces of designs from django-registration remaining, which I intend to get rid of at some point of time. Piston was a similar case. It lacked support for customizing response keys if you wanted to use a Model handler. Let me explain. Django is built on the <span class="caps">MVC</span> architecture, except that its more MTV (Model-Template-View). A typical model looks&nbsp;such: </p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span>:</span>
    title = models.CharField(max_length=<span class="number">256</span>, db_index=<span class="keyword">True</span>)
    author = models.CharField(max_length=<span class="number">512</span>, db_index=<span class="keyword">True</span>)
    published = models.DateTimeField(db_index=<span class="keyword">True</span>)
</code></pre>
<p>Piston, with its default integration, allows you to create a handler which directly ties to a&nbsp;model:</p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">BookHandler</span><span class="params">(BaseHandler)</span>:</span>
     allowed_methods = (<span class="string">'<span class="caps">GET</span>'</span>, <span class="string">'<span class="caps">POST</span>'</span>, <span class="string">'<span class="caps">PUT</span>'</span>, <span class="string">'<span class="caps">DELETE</span>'</span>)
     fields = (<span class="string">'id'</span>, <span class="string">'title'</span>, <span class="string">'author'</span> )
     model = Book
</code></pre>
<p>So far, so good. My problem with this was that I can’t expose the ‘title’ field as ‘book_name’ or anything else if I wanted to. Piston did not have support for inbuilt mappings of such kind. The only way out would have been to write a method like&nbsp;so: </p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">BookHandler</span><span class="params">(BaseHandler)</span>:</span>
     allowed_methods = (<span class="string">'<span class="caps">GET</span>'</span>, <span class="string">'<span class="caps">POST</span>'</span>, <span class="string">'<span class="caps">PUT</span>'</span>, <span class="string">'<span class="caps">DELETE</span>'</span>)
     fields = (<span class="string">'id'</span>, <span class="string">'book_name'</span>, <span class="string">'author'</span> )
     model = Book

<span class="decorator">@staticmethod</span>
     <span class="function"><span class="keyword">def</span> <span class="title">book_name</span><span class="params">(object)</span>:</span>
         <span class="keyword">return</span> object.title
</code></pre>
<p>Which, I felt, was overkill to do each time I wanted a custom field name. So I chose to go ahead and modify the emitters module which processes the input format and returns the output. I have already <a href="https://bitbucket.org/bhashkar/django-piston/">forked</a> piston, but yet have to apply the patch to it. Will do it soon, I promise. I also added Session-based authentication support to it. Now for the same outcome, all you need to do is the&nbsp;following:</p>
<pre><code class="lang-python"><span class="class"><span class="keyword">class</span> <span class="title">BookHandler</span><span class="params">(BaseHandler)</span>:</span>
    allowed_methods = (<span class="string">'<span class="caps">GET</span>'</span>, <span class="string">'<span class="caps">POST</span>'</span>, <span class="string">'<span class="caps">PUT</span>'</span>, <span class="string">'<span class="caps">DELETE</span>'</span>)
    fields = (<span class="string">'id'</span>, { <span class="string">'book_name'</span> : <span class="string">'title'</span> }, <span class="string">'author'</span> )
    model = Book
</code></pre>
<p>That’s right! I added yet another fork to the already present tons of piston forks in the World. C’est la&nbsp;vie.</p>
<p>Peace out,&nbsp;people!</p>
<p>[<strong><span class="caps">PS</span>:</strong> You might be interested in reading this post by the author of Django about the <span class="caps">REST</span> API worst practices: <a href="http://jacobian.org/writing/rest-worst-practices">http://jacobian.org/writing/rest-worst-practices</a>]</p>

        </section>

        <div class="sharer">
    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://bhashkar.me/2012/05/06/hacking-django-piston/" class="facebook-share"><i class="fa fa-facebook-square"></i></a>
    <a target="_blank" href="https://twitter.com/home?status=http://bhashkar.me/2012/05/06/hacking-django-piston/" class="twitter-share"><i class="fa fa-twitter-square"></i></a>
</div>

        

    </article>

    <!-- Back to Blog Box -->
    <article id="blog-box" class="container box style2">
        <div class="inner">
            <a href="/blog/" class="button">Return to blog</a>
        </div>
    </article>
</section>

            
            </div>

        <!-- Footer -->
            <div id="footer">
                
                <!-- Copyright -->
                    <ul class="copyright">
                        <li>&copy; Bhashkar Sharma. All rights reserved.</li>
                        <li>Theme by <a href="http://html5up.net">HTML5 UP</a></li>
                        <li>Generated using <a href="http://wintersmith.io">Wintersmith</a></li>
                    </ul>
                
            </div>

    
    
    

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2340837-4', 'bhashkar.me');
  ga('send', 'pageview');
</script>

    </body>
</html>